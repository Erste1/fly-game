<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<title>Neon Dash</title>

<style>
/* =========================
   MODERN MOBILE UI
========================= */

:root{
--bg:#0b0f14;
--panel:#111827;
--card:#1f2937;
--green:#2ecc71;
--yellow:#f1c40f;
--red:#e74c3c;
}

*{box-sizing:border-box}

body{
margin:0;
overflow:hidden;
background:var(--bg);
font-family:system-ui;
color:#fff;
}

/* ===== TOP BAR ===== */

#topbar{
position:fixed;
top:0;
left:0;
width:100%;
height:70px;
background:var(--panel);
display:flex;
align-items:center;
justify-content:space-between;
padding:0 16px;
z-index:10;
box-shadow:0 6px 20px rgba(0,0,0,.6);
}

.btn{
background:var(--card);
border:none;
color:white;
padding:10px 14px;
border-radius:12px;
font-size:14px;
margin-left:6px;
}

/* ===== CANVAS ===== */

canvas{
position:fixed;
bottom:0;
left:0;
width:100%;
height:calc(100vh - 70px);
}

/* ===== MODAL ===== */

.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.85);
display:flex;
align-items:center;
justify-content:center;
z-index:20;
}

.card{
background:#111;
padding:20px;
border-radius:20px;
width:92%;
max-width:380px;
max-height:80vh;
overflow:auto;
}

.grid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
margin-top:10px;
}

.item{
background:#222;
padding:14px;
border-radius:12px;
text-align:center;
font-size:13px;
}

.item.active{outline:3px solid var(--green)}
.item.lock{opacity:.4}
</style>
</head>

<body>

<!-- TOP UI -->
<div id="topbar">
<div>üí∞ <span id="coins">0</span></div>
<div>
<button class="btn" onclick="Game.pause()">‚è∏</button>
<button class="btn" onclick="Shop.open()">üõí</button>
<button class="btn" onclick="Game.menu()">üè†</button>
</div>
</div>

<canvas id="c"></canvas>

<!-- SHOP -->
<div id="shop" class="modal" style="display:none">
<div class="card">
<h3>–ú–ê–ì–ê–ó–ò–ù</h3>
<div id="items" class="grid"></div>
<button class="btn" onclick="Shop.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>

<script>
/* =========================
   TELEGRAM
========================= */
if(window.Telegram?.WebApp) Telegram.WebApp.expand();

/* =========================
   CANVAS
========================= */
const canvas=c;
const ctx=canvas.getContext("2d");

function resize(){
canvas.width=innerWidth;
canvas.height=innerHeight-70;
}
resize();
addEventListener("resize",resize);

/* =========================
   SAVE
========================= */
const Save={
g:(k,d)=>JSON.parse(localStorage.getItem(k))??d,
s:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};

/* =========================
   STATE
========================= */
const State={
coins:Save.g("coins",0),
owned:Save.g("owned",["c0"]),
active:Save.g("active",{color:"#2ecc71",shape:"square",bg:"#001b2f"})
};

/* =========================
   SHOP DB
========================= */
const DB=[
{id:"c0",type:"color",val:"#2ecc71",p:0},
{id:"c1",type:"color",val:"#e74c3c",p:20},
{id:"c2",type:"color",val:"#f1c40f",p:40},
{id:"c3",type:"color",val:"#3498db",p:60},

{id:"b0",type:"bg",val:"#001b2f",p:0},
{id:"b1",type:"bg",val:"#220000",p:50},
{id:"b2",type:"bg",val:"#002b10",p:50}
];

/* =========================
   SHOP
========================= */
const Shop={
open(){shop.style.display="flex";this.render()},
close(){shop.style.display="none"},
render(){
items.innerHTML="";
DB.forEach(it=>{
const own=State.owned.includes(it.id);
const d=document.createElement("div");
d.className="item"+(own?"":" lock");

d.innerHTML= own?"USE":"üí∞ "+it.p;

d.onclick=()=>{
if(own){
State.active[it.type]=it.val;
}
else if(State.coins>=it.p){
State.coins-=it.p;
State.owned.push(it.id);
State.active[it.type]=it.val;
Save.s("coins",State.coins);
Save.s("owned",State.owned);
}
Save.s("active",State.active);
UI.refresh();
this.render();
};
items.appendChild(d);
});
}
};

/* =========================
   PLAYER
========================= */
const Player={
x:80,y:0,vy:0,
size:40,

reset(){this.y=Game.ground-this.size;this.vy=0},

jump(){
if(this.y>=Game.ground-this.size-2)
this.vy=-14;
},

update(){
this.vy+=0.8;
this.y+=this.vy;

if(this.y>Game.ground-this.size){
this.y=Game.ground-this.size;
this.vy=0;
}
},

draw(){
ctx.fillStyle=State.active.color;
ctx.fillRect(this.x,this.y,this.size,this.size);
}
};

/* =========================
   GAME
========================= */
const Game={
active:true,
ground:0,
speed:7,
score:0,
objs:[],

pause(){this.active=!this.active},
menu(){location.reload()},

update(){
if(!this.active)return;

Player.update();

if(Math.random()<0.02)
this.objs.push({x:canvas.width,type:"spike"});

if(Math.random()<0.02)
this.objs.push({x:canvas.width,y:this.ground-60-Math.random()*120,type:"coin"});

for(let i=this.objs.length-1;i>=0;i--){
const o=this.objs[i];
o.x-=this.speed;

if(o.type==="spike"){
if(Math.abs(o.x-Player.x)<35 && Player.y>this.ground-60)
this.menu();
}
else{
if(Math.hypot(o.x-Player.x,o.y-Player.y)<30){
State.coins++;
Save.s("coins",State.coins);
this.objs.splice(i,1);
continue;
}
}

if(o.x<-50)this.objs.splice(i,1);
}
},

draw(){
ctx.fillStyle=State.active.bg;
ctx.fillRect(0,0,canvas.width,canvas.height);

this.ground=canvas.height-100;

ctx.fillStyle="#111";
ctx.fillRect(0,this.ground,canvas.width,100);

this.objs.forEach(o=>{
if(o.type==="spike"){
ctx.fillStyle="#333";
ctx.fillRect(o.x,this.ground-40,40,40);
}else{
ctx.fillStyle="#f1c40f";
ctx.beginPath();
ctx.arc(o.x,o.y,10,0,Math.PI*2);
ctx.fill();
}
});

Player.draw();
}
};

/* =========================
   UI
========================= */
const UI={
refresh(){coins.textContent=State.coins}
};
UI.refresh();

/* =========================
   LOOP
========================= */
function loop(){
Game.update();
Game.draw();
requestAnimationFrame(loop);
}
loop();

/* INPUT */
addEventListener("mousedown",()=>Player.jump());
addEventListener("touchstart",e=>{e.preventDefault();Player.jump()},{passive:false});
</script>

</body>
</html>
