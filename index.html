<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GD FIX</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #m { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; justify-content:center; align-items:center; z-index:100; color:#fff; flex-direction:column; }
        button { padding: 20px 40px; font-size: 25px; background: #2ecc71; color: #fff; border:none; border-radius:10px; }
    </style>
</head>
<body>
    <div id="m"><h1 id="h">ГОТОВ?</h1><button onclick="start()">ИГРАТЬ</button></div>
    <canvas id="c"></canvas>
    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        let active = false;
        let score = 0;
        let time = 0;
        let obs = [];
        const floor = canvas.height - 100;
        const p = { x: 50, y: floor - 40, v: 0 };

        function start() {
            // Сброс всего
            obs = []; time = 0; score = 0; p.v = 0; p.y = floor - 40;
            document.getElementById('m').style.display = 'none';
            // Активация только через полсекунды
            setTimeout(() => { active = true; }, 500);
        }

        function loop() {
            ctx.fillStyle = '#0072ff'; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = '#005bb5'; ctx.fillRect(0, floor, canvas.width, 100);

            if (active) {
                time++;
                p.v += 0.8; p.y += p.v;
                if (p.y > floor - 40) { p.y = floor - 40; p.v = 0; }

                // ШИПЫ ПОЯВЯТСЯ ТОЛЬКО ЧЕРЕЗ 5 СЕКУНД (300 кадров)
                if (time > 300 && time % 120 === 0) {
                    obs.push({ x: canvas.width });
                }

                for (let i = obs.length - 1; i >= 0; i--) {
                    obs[i].x -= 7;
                    ctx.fillStyle = 'red';
                    ctx.beginPath(); ctx.moveTo(obs[i].x, floor); ctx.lineTo(obs[i].x+20, floor-40); ctx.lineTo(obs[i].x+40, floor); ctx.fill();

                    // Проверка смерти (супер-строгая)
                    if (obs[i].x < 80 && obs[i].x > 20 && p.y > floor - 45) {
                        active = false;
                        document.getElementById('m').style.display = 'flex';
                        document.getElementById('h').innerText = "GAME OVER";
                    }
                    if (obs[i].x < -50) obs.splice(i, 1);
                }
            }
            ctx.fillStyle = '#0f0'; ctx.fillRect(p.x, p.y, 40, 40);
            requestAnimationFrame(loop);
        }
        window.onclick = () => { if (active && p.y >= floor - 41) p.v = -12; };
        loop();
    </script>
</body>
</html>
