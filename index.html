<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Neon Dash Ultimate</title>

<style>
:root{
 --accent:#00ffb3;
 --glass:rgba(255,255,255,.08);
}

body{
 margin:0;
 overflow:hidden;
 background:#000;
 font-family:system-ui;
 color:#fff;
}

canvas{display:block}

/* HUD */
#hud{
 position:fixed;
 top:12px;
 width:100%;
 display:flex;
 justify-content:space-between;
 padding:0 16px;
 font-weight:700;
 z-index:5;
}

/* PROGRESS */
#bar{
 position:fixed;
 bottom:0;
 left:0;
 height:5px;
 background:var(--accent);
 width:0%;
}

/* ===== MODAL ===== */
.modal{
 position:fixed;
 inset:0;
 display:flex;
 justify-content:center;
 align-items:center;
 backdrop-filter:blur(16px);
 background:rgba(0,0,0,.7);
 z-index:20;
}

.card{
 width:90%;
 max-width:380px;
 background:var(--glass);
 border-radius:22px;
 padding:22px;
 text-align:center;
 border:1px solid rgba(255,255,255,.15);
}

.btn{
 width:100%;
 padding:14px;
 margin:6px 0;
 border:none;
 border-radius:14px;
 font-weight:800;
 font-size:16px;
 background:var(--accent);
 color:#000;
}

.grid{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 margin-top:10px;
}

.colorItem{
 height:50px;
 border-radius:12px;
 border:3px solid #000;
}
.colorItem.active{
 border:3px solid #fff;
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="hud">
 <div>SCORE <span id="score">0</span></div>
 <div>ðŸ’° <span id="coins">0</span></div>
</div>

<div id="bar"></div>

<!-- MENU -->
<div id="menu" class="modal">
 <div class="card">
  <h2>NEON DASH</h2>
  <button class="btn" id="playBtn">PLAY</button>
  <button class="btn" id="shopBtn">SHOP</button>
 </div>
</div>

<!-- SHOP -->
<div id="shop" class="modal" style="display:none">
 <div class="card">
  <h3>COLOR SHOP</h3>
  <div id="colors" class="grid"></div>
  <button class="btn" id="closeShop">BACK</button>
 </div>
</div>

<script>
/* ===== CANVAS ===== */
const canvas=c;
const ctx=canvas.getContext("2d");

function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

/* ===== SAVE ===== */
const S={
 load:(k,d)=>JSON.parse(localStorage.getItem(k))??d,
 set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};

let coinsVal=S.load("coins",0);
let activeColor=S.load("color","#00ffb3");

/* ===== SHOP ===== */
const COLORS=[
 "#00ffb3","#e74c3c","#3498db","#f1c40f","#9b59b6","#ffffff"
];

function renderShop(){
 colors.innerHTML="";
 COLORS.forEach(col=>{
  const d=document.createElement("div");
  d.className="colorItem"+(col===activeColor?" active":"");
  d.style.background=col;
  d.onpointerdown=()=>{
   activeColor=col;
   S.set("color",col);
   renderShop();
  };
  colors.appendChild(d);
 });
}
renderShop();

/* ===== PLAYER ===== */
const Player={
 x:80,y:0,vy:0,rot:0,jumps:0,

 reset(){
  this.y=Game.ground-40;
  this.vy=0;
  this.rot=0;
  this.jumps=0;
 },

 jump(){
  if(this.jumps<2){
   this.vy=-14;
   this.jumps++;
  }
 },

 update(){
  this.vy+=0.9;
  this.y+=this.vy;

  if(this.y>=Game.ground-40){
   this.y=Game.ground-40;
   this.vy=0;
   this.jumps=0;

   /* ðŸ”¥ Ð ÐžÐ’ÐÐž */
   this.rot=Math.round(this.rot/90)*90;
  }else{
   this.rot+=10;
  }
 },

 draw(){
  ctx.save();
  ctx.translate(this.x+20,this.y+20);
  ctx.rotate(this.rot*Math.PI/180);
  ctx.fillStyle=activeColor;
  ctx.shadowColor=activeColor;
  ctx.shadowBlur=20;
  ctx.fillRect(-20,-20,40,40);
  ctx.restore();
 }
};

/* ===== GAME ===== */
const Game={
 active:false,
 score:0,
 speed:7,
 ground:0,
 spikes:[],
 frame:0,

 start(){
  menu.style.display="none";
  this.active=true;
  this.score=0;
  this.speed=7;
  this.spikes=[];
  Player.reset();
 },

 over(){
  this.active=false;
  menu.style.display="flex";
 },

 update(){
  if(!this.active)return;

  this.frame++;
  Player.update();

  if(this.frame%80===0)
   this.spikes.push({x:canvas.width});

  for(let s of this.spikes) s.x-=this.speed;

  this.spikes=this.spikes.filter(s=>{
   if(Math.abs(s.x-Player.x)<30 && Player.y>this.ground-60)
    this.over();

   if(s.x<-40){
    this.score++;
    return false;
   }
   return true;
  });
 },

 drawBG(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#00151d");
  g.addColorStop(1,"#000");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);
 },

 draw(){
  this.ground=canvas.height-120;

  this.drawBG();

  ctx.fillStyle="#111";
  ctx.fillRect(0,this.ground,canvas.width,200);

  /* ðŸ”¥ ÐÐ•ÐžÐÐžÐ’Ð«Ð• Ð¨Ð˜ÐŸÐ« */
  ctx.fillStyle="#ff0055";
  ctx.shadowColor="#ff0055";
  ctx.shadowBlur=20;

  this.spikes.forEach(s=>{
   ctx.beginPath();
   ctx.moveTo(s.x,this.ground);
   ctx.lineTo(s.x+20,this.ground-40);
   ctx.lineTo(s.x+40,this.ground);
   ctx.fill();
  });

  ctx.shadowBlur=0;

  Player.draw();
 }
};

/* ===== LOOP ===== */
function loop(){
 Game.update();
 Game.draw();

 score.textContent=Game.score;
 coins.textContent=coinsVal;
 bar.style.width=(Game.score%100)+"%";

 requestAnimationFrame(loop);
}
loop();

/* ===== INPUT ===== */
addEventListener("pointerdown",()=>Player.jump());

/* ===== BUTTONS ===== */
playBtn.onpointerdown=()=>Game.start();
shopBtn.onpointerdown=()=>shop.style.display="flex";
closeShop.onpointerdown=()=>shop.style.display="none";
</script>
</body>
</html>
