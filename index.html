<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<title>Neon Dash Ultra</title>

<style>
:root{
 --accent:#00ffae;
 --glass:rgba(255,255,255,.08);
}

*{box-sizing:border-box}

body{
 margin:0;
 overflow:hidden;
 font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
 background:#000;
 color:#fff;
}

/* ===== HUD ===== */
#hud{
 position:fixed;
 top:10px;
 width:100%;
 padding:0 16px;
 display:flex;
 justify-content:space-between;
 font-weight:700;
 z-index:5;
}

#bar{
 position:fixed;
 bottom:0;
 left:0;
 height:6px;
 background:var(--accent);
 width:0%;
}

/* ===== MODERN MENU ===== */
.modal{
 position:fixed;
 inset:0;
 display:flex;
 justify-content:center;
 align-items:center;
 backdrop-filter:blur(14px);
 background:rgba(0,0,0,.65);
}

.card{
 width:90%;
 max-width:380px;
 background:var(--glass);
 border-radius:24px;
 padding:26px;
 text-align:center;
 border:1px solid rgba(255,255,255,.12);
 animation:pop .3s ease;
}

@keyframes pop{
 from{transform:scale(.9);opacity:0}
}

.btn{
 width:100%;
 padding:14px;
 margin:7px 0;
 border:none;
 border-radius:16px;
 background:var(--accent);
 font-weight:800;
 font-size:17px;
}

canvas{display:block}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="hud">
 <div>SCORE <span id="score">0</span></div>
 <div>ðŸ’° <span id="coins">0</span></div>
</div>

<div id="bar"></div>

<div id="menu" class="modal">
 <div class="card">
  <h2>NEON DASH</h2>
  <button class="btn" onclick="Game.start()">PLAY</button>
 </div>
</div>

<script>
/* ===== TELEGRAM SAFE ===== */
if(window.Telegram?.WebApp){
 Telegram.WebApp.expand();
 setTimeout(resize,200);
}

/* ===== CANVAS ===== */
const canvas=c;
const ctx=canvas.getContext("2d");

function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

/* ===== SAVE ===== */
const S={
 load:(k,d)=>JSON.parse(localStorage.getItem(k))??d,
 set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};

let coinsVal=S.load("coins",0);

/* ===== PARTICLES ===== */
const Particles=[];
function spawn(x,y){
 for(let i=0;i<12;i++){
  Particles.push({
   x,y,
   vx:(Math.random()-0.5)*6,
   vy:(Math.random()-0.5)*6,
   life:30
  });
 }
}

/* ===== PLAYER ===== */
const Player={
 x:90,y:0,vy:0,
 rot:0,
 jumps:0,

 reset(){
  this.y=Game.ground-40;
  this.vy=0;
  this.rot=0;
  this.jumps=0;
 },

 jump(){
  if(this.jumps<2){
   this.vy=-14;
   this.jumps++;
   spawn(this.x,this.y+20);
   navigator.vibrate?.(10);
  }
 },

 update(){
  this.vy+=0.9;
  this.y+=this.vy;

  if(this.y>=Game.ground-40){
   this.y=Game.ground-40;
   this.vy=0;
   this.jumps=0;

   /* ðŸ”¥ Ð–ÐÐ¡Ð¢ÐšÐ˜Ð™ SNAP 90Â° */
   this.rot = Math.round(this.rot/90)*90;
  }else{
   this.rot+=10;
  }
 },

 draw(){
  ctx.save();
  ctx.translate(this.x+20,this.y+20);
  ctx.rotate(this.rot*Math.PI/180);

  ctx.shadowColor="#00ffae";
  ctx.shadowBlur=25;

  ctx.fillStyle="#00ffae";
  ctx.fillRect(-20,-20,40,40);

  ctx.restore();
 }
};

/* ===== GAME ===== */
const Game={
 active:false,
 score:0,
 ground:0,
 speed:7,
 objs:[],
 frame:0,

 start(){
  menu.style.display="none";
  this.active=true;
  this.score=0;
  this.speed=7;
  this.objs=[];
  Player.reset();
 },

 over(){
  this.active=false;
  spawn(Player.x,Player.y);
  menu.style.display="flex";
 },

 update(){
  if(!this.active)return;

  this.frame++;

  if(this.frame%80===0)
   this.objs.push({x:canvas.width});

  this.speed+=0.0007;

  Player.update();

  for(let i=this.objs.length-1;i>=0;i--){
   const o=this.objs[i];
   o.x-=this.speed;

   if(Math.abs(o.x-Player.x)<30 && Player.y>this.ground-60){
    this.over();
   }

   if(o.x<-40){
    this.score++;
    this.objs.splice(i,1);
   }
  }
 },

 drawBG(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#00121c");
  g.addColorStop(1,"#000");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="rgba(255,255,255,.05)";
  for(let i=0;i<canvas.width;i+=40){
   ctx.beginPath();
   ctx.moveTo(i,0);
   ctx.lineTo(i,canvas.height);
   ctx.stroke();
  }
 },

 draw(){
  this.ground=canvas.height-110;

  this.drawBG();

  ctx.fillStyle="#111";
  ctx.fillRect(0,this.ground,canvas.width,200);

  this.objs.forEach(o=>{
   ctx.fillStyle="#222";
   ctx.fillRect(o.x,this.ground-40,40,40);
  });

  Particles.forEach((p,i)=>{
   p.x+=p.vx;
   p.y+=p.vy;
   p.life--;
   ctx.globalAlpha=p.life/30;
   ctx.fillRect(p.x,p.y,3,3);
   ctx.globalAlpha=1;
   if(p.life<=0)Particles.splice(i,1);
  });

  Player.draw();
 }
};

/* ===== LOOP ===== */
function loop(){
 Game.update();
 Game.draw();

 score.textContent=Game.score;
 coins.textContent=coinsVal;
 bar.style.width=(Game.score%100)+"%";

 requestAnimationFrame(loop);
}
loop();

/* ===== INPUT (ÐœÐžÐ‘Ð˜Ð›Ð¬ÐÐ«Ð™ Ð¤Ð˜ÐšÐ¡) ===== */
addEventListener("pointerdown",()=>Player.jump());
</script>
</body>
</html>
