<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>

<title>Neon Dash Mini App</title>

<style>
/* =========================
   NEON GEOMETRY DASH STYLE
   ========================= */

:root{
    --green:#2ecc71;
    --yellow:#f1c40f;
    --blue:#3498db;
    --red:#e74c3c;
    --bg:#000;
}

*{box-sizing:border-box}

body{
    margin:0;
    overflow:hidden;
    background:#000;
    font-family: "Arial Black", sans-serif;
    user-select:none;
}

/* CANVAS */
canvas{display:block}

/* HUD */
#hud{
    position:fixed;
    top:15px;
    left:0;
    width:100%;
    display:flex;
    justify-content:space-between;
    padding:0 20px;
    color:white;
    font-size:20px;
    text-shadow:0 0 6px #000;
    z-index:5;
}

/* MODALS */
.modal{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.9);
    z-index:10;
}

.card{
    width:92%;
    max-width:380px;
    background:#111;
    border-radius:25px;
    padding:25px;
    border:4px solid #222;
    box-shadow:0 0 30px #000;
    text-align:center;
    color:white;
}

/* BUTTON */
.btn{
    width:100%;
    padding:16px;
    margin:8px 0;
    font-size:18px;
    font-weight:bold;
    border:none;
    border-radius:14px;
    background:var(--green);
    color:white;
    cursor:pointer;
}

.btn:active{transform:scale(.97)}

.btn.red{background:var(--red)}
.btn.blue{background:var(--blue)}

/* SHOP */
.grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
    max-height:260px;
    overflow:auto;
    margin-top:10px;
}

.item{
    background:#222;
    padding:10px;
    border-radius:12px;
    border:3px solid #333;
    font-size:12px;
    cursor:pointer;
}

.item.owned{border-color:#555}
.item.active{border-color:var(--green);background:#173826}

.tabs{
    display:flex;
    gap:5px;
}

.tab{
    flex:1;
    background:#333;
    border-radius:8px;
    padding:8px;
    font-size:12px;
    cursor:pointer;
}

.tab.active{background:var(--green)}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="hud">
    <div>SCORE: <span id="score">0</span></div>
    <div style="color:var(--yellow)">ðŸ’° <span id="coins">0</span></div>
</div>

<!-- MAIN -->
<div id="menu" class="modal">
    <div class="card">
        <h2>NEON DASH</h2>
        <button class="btn" onclick="Game.start()">PLAY</button>
        <button class="btn blue" onclick="Shop.open()">SHOP</button>
        <div style="margin-top:12px;color:#aaa">BEST: <span id="best">0</span></div>
    </div>
</div>

<!-- SHOP -->
<div id="shop" class="modal" style="display:none">
    <div class="card">
        <h3>SHOP</h3>

        <div class="tabs">
            <div class="tab active" onclick="Shop.set('color')">COLOR</div>
            <div class="tab" onclick="Shop.set('shape')">SHAPE</div>
            <div class="tab" onclick="Shop.set('world')">WORLD</div>
        </div>

        <div id="items" class="grid"></div>

        <button class="btn red" onclick="Shop.close()">EXIT</button>
    </div>
</div>

<script>
/* ======================================
   TELEGRAM MINI APP READY
====================================== */
if(window.Telegram?.WebApp){
    Telegram.WebApp.expand();
}

/* ======================================
   CANVAS
====================================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ======================================
   SAVE SYSTEM
====================================== */
const Save = {
    load(key,def){ return JSON.parse(localStorage.getItem(key)) ?? def; },
    set(key,val){ localStorage.setItem(key,JSON.stringify(val)); }
};

/* ======================================
   STATE
====================================== */
const State = {
    coins: Save.load("coins",0),
    best: Save.load("best",0),
    owned: Save.load("owned",["c0","s0","w0"]),
    active:{color:"#2ecc71",shape:"square",world:"#001b2f"}
};

/* ======================================
   DATABASE SHOP
====================================== */
const DB={
color:[
 {id:"c0",val:"#2ecc71",p:0},
 {id:"c1",val:"#e74c3c",p:15},
 {id:"c2",val:"#f1c40f",p:30},
 {id:"c3",val:"#3498db",p:50}
],
shape:[
 {id:"s0",val:"square",p:0},
 {id:"s1",val:"circle",p:25},
 {id:"s2",val:"diamond",p:50}
],
world:[
 {id:"w0",val:"#001b2f",p:0},
 {id:"w1",val:"#2b0000",p:40},
 {id:"w2",val:"#001b0d",p:40}
]
};

/* ======================================
   SHOP
====================================== */
const Shop={
tab:"color",

open(){ shop.style.display="flex"; this.render(); },
close(){ shop.style.display="none"; },

set(t){
    this.tab=t;
    document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
    event.target.classList.add("active");
    this.render();
},

render(){
    items.innerHTML="";
    DB[this.tab].forEach(it=>{
        const owned = State.owned.includes(it.id);
        const active = State.active[this.tab]===it.val;

        const d=document.createElement("div");
        d.className="item "+(owned?"owned ":"")+(active?"active":"");
        d.innerHTML = owned?(active?"ACTIVE":"USE"):"ðŸ’° "+it.p;

        d.onclick=()=>this.buy(it);
        items.appendChild(d);
    });
},

buy(it){
    if(State.owned.includes(it.id)){
        State.active[this.tab]=it.val;
    }else if(State.coins>=it.p){
        State.coins-=it.p;
        State.owned.push(it.id);
        State.active[this.tab]=it.val;
        Save.set("owned",State.owned);
    }
    Save.set("coins",State.coins);
    UI.refresh();
    this.render();
}
};

/* ======================================
   PLAYER
====================================== */
const Player={
x:80,y:0,vy:0,rot:0,

reset(){ this.y=Game.ground-40; this.vy=0; this.rot=0; },

jump(){ if(this.y>=Game.ground-42) this.vy=-14; },

update(){
    this.vy+=0.9;
    this.y+=this.vy;

    if(this.y>Game.ground-40){
        this.y=Game.ground-40;
        this.vy=0;
    } else this.rot+=7;
},

draw(){
    ctx.save();
    ctx.translate(this.x+20,this.y+20);
    ctx.rotate(this.rot*Math.PI/180);

    ctx.fillStyle=State.active.color;

    if(State.active.shape==="circle"){
        ctx.beginPath();
        ctx.arc(0,0,20,0,Math.PI*2);
        ctx.fill();
    }
    else if(State.active.shape==="diamond"){
        ctx.rotate(Math.PI/4);
        ctx.fillRect(-18,-18,36,36);
    }
    else{
        ctx.fillRect(-20,-20,40,40);
    }

    ctx.restore();
}
};

/* ======================================
   GAME ENGINE
====================================== */
const Game={
active:false,
ground:0,
score:0,
speed:7,
objs:[],
frame:0,

start(){
    menu.style.display="none";
    this.active=true;
    this.score=0;
    this.speed=7;
    this.frame=0;
    this.objs=[];
    Player.reset();
},

over(){
    this.active=false;
    if(this.score>State.best){
        State.best=this.score;
        Save.set("best",State.best);
    }
    menu.style.display="flex";
    UI.refresh();
},

update(){
    if(!this.active) return;

    this.frame++;
    Player.update();

    if(this.frame%80===0) this.objs.push({x:canvas.width,type:"spike"});
    if(this.frame%120===0) this.objs.push({x:canvas.width,y:this.ground-80-Math.random()*120,type:"coin"});

    for(let i=this.objs.length-1;i>=0;i--){
        const o=this.objs[i];
        o.x-=this.speed;

        if(o.type==="spike"){
            if(Math.abs(o.x-Player.x)<30 && Player.y>this.ground-60) this.over();
        }
        else{
            if(Math.hypot(o.x-Player.x, o.y-Player.y)<30){
                State.coins++;
                Save.set("coins",State.coins);
                this.objs.splice(i,1);
                continue;
            }
        }

        if(o.x<-60){
            if(o.type==="spike") this.score++;
            this.objs.splice(i,1);
        }
    }
},

draw(){
    ctx.fillStyle=State.active.world;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    this.ground=canvas.height-120;

    ctx.fillStyle="#111";
    ctx.fillRect(0,this.ground,canvas.width,200);

    this.objs.forEach(o=>{
        if(o.type==="spike"){
            ctx.fillStyle="#222";
            ctx.fillRect(o.x,this.ground-40,40,40);
        }else{
            ctx.fillStyle="#f1c40f";
            ctx.beginPath();
            ctx.arc(o.x,o.y,10,0,Math.PI*2);
            ctx.fill();
        }
    });

    Player.draw();
}
};

/* ======================================
   UI
====================================== */
const UI={
refresh(){
    score.textContent=Game.score;
    coins.textContent=State.coins;
    best.textContent=State.best;
}
};

/* ======================================
   LOOP
====================================== */
function loop(){
    Game.update();
    Game.draw();
    UI.refresh();
    requestAnimationFrame(loop);
}
loop();

/* INPUT */
addEventListener("mousedown",()=>Player.jump());
addEventListener("touchstart",(e)=>{e.preventDefault();Player.jump();},{passive:false});
</script>
</body>
</html>
