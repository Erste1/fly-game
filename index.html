<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geometry Dash Mega Mod</title>
    <style>
        :root { --primary: #2ecc71; --accent: #f1c40f; --bg: #000; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: var(--bg); font-family: 'Arial Black', sans-serif; user-select: none; }
        canvas { display: block; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; color: white; font-size: 24px; text-shadow: 2px 2px 0 #000; }
        
        /* –û–∫–Ω–∞ –º–µ–Ω—é */
        .modal { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 100; color: white; 
        }
        .window { 
            background: #1a1a1a; padding: 30px; border-radius: 20px; border: 4px solid #333; 
            width: 85%; max-width: 350px; text-align: center; box-shadow: 0 0 30px rgba(0,0,0,1); 
        }
        
        h1 { font-size: 32px; margin: 0 0 20px; color: var(--primary); text-transform: uppercase; }
        .btn { 
            width: 100%; padding: 15px; margin: 10px 0; font-size: 22px; font-weight: bold;
            background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer;
            box-shadow: 0 6px 0 #1a5e3a; transition: 0.1s; pointer-events: all;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #1a5e3a; }
        .btn-blue { background: #3498db; box-shadow: 0 6px 0 #21618c; }
        .btn-blue:active { box-shadow: 0 3px 0 #21618c; }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-tabs { display: flex; gap: 5px; margin-bottom: 15px; pointer-events: all; }
        .tab { flex: 1; padding: 8px; font-size: 12px; background: #333; border-radius: 5px; cursor: pointer; }
        .tab.active { background: var(--primary); }
        
        .grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; 
            max-height: 250px; overflow-y: auto; padding-right: 5px; pointer-events: all;
        }
        .item { 
            background: #252525; padding: 10px; border-radius: 10px; border: 2px solid #444; 
            display: flex; flex-direction: column; align-items: center; 
        }
        .item.owned { border-color: var(--primary); }
        .item.active { background: #1e3a2a; border-color: #fff; }
        .item-icon { width: 40px; height: 40px; margin-bottom: 5px; border: 1px solid #555; }
        .price { color: var(--accent); font-size: 14px; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="hud">
            <div>SCORE: <span id="cur-score">0</span></div>
            <div style="color: #f1c40f;">üí∞ <span id="coins">0</span></div>
        </div>
    </div>

    <div id="menu" class="modal">
        <div class="window">
            <h1 id="m-title">CYBER DASH</h1>
            <button class="btn" onclick="game.start()">PLAY</button>
            <button class="btn btn-blue" onclick="shop.open()">SHOP</button>
            <div style="margin-top: 10px; font-size: 14px; color: #666;">BEST: <span id="best-score">0</span></div>
        </div>
    </div>

    <div id="shop" class="modal" style="display: none;">
        <div class="window">
            <h1>MARKET</h1>
            <div class="shop-tabs">
                <div class="tab active" onclick="shop.setTab('color')">–¶–í–ï–¢</div>
                <div class="tab" onclick="shop.setTab('shape')">–§–û–†–ú–ê</div>
                <div class="tab" onclick="shop.setTab('world')">–ú–ò–†</div>
            </div>
            <div id="shop-grid" class="grid"></div>
            <button class="btn" style="margin-top: 20px; background: #e74c3c; box-shadow: 0 6px 0 #922b21;" onclick="shop.close()">BACK</button>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ò –î–ê–ù–ù–´–ï ---
        let storage = {
            coins: parseInt(localStorage.getItem('gd_coins')) || 0,
            best: parseInt(localStorage.getItem('gd_best')) || 0,
            owned: JSON.parse(localStorage.getItem('gd_owned')) || ['c_#2ecc71', 's_square', 'w_#0051a8'],
            active: { color: '#2ecc71', shape: 'square', world: '#0051a8' }
        };

        const db = {
            color: [
                { id: 'c_#2ecc71', name: '–ó–µ–ª–µ–Ω—å', p: 0, val: '#2ecc71' },
                { id: 'c_#e74c3c', name: '–ü–ª–∞–º—è', p: 10, val: '#e74c3c' },
                { id: 'c_#3498db', name: '–û–∫–µ–∞–Ω', p: 15, val: '#3498db' },
                { id: 'c_#f1c40f', name: 'Gold', p: 50, val: '#f1c40f' }
            ],
            shape: [
                { id: 's_square', name: '–ö—É–±', p: 0, val: 'square' },
                { id: 's_eye', name: '–ì–ª–∞–∑', p: 20, val: 'eye' },
                { id: 's_smile', name: '–°–º–∞–π–ª', p: 25, val: 'smile' },
                { id: 's_alien', name: '–ù–õ–û', p: 40, val: 'alien' }
            ],
            world: [
                { id: 'w_#0051a8', name: '–ù–µ–æ–Ω', p: 0, val: '#0051a8' },
                { id: 'w_#3d0000', name: '–ê–¥', p: 30, val: '#3d0000' },
                { id: 'w_#003d0c', name: '–õ–µ—Å', p: 30, val: '#003d0c' }
            ]
        };

        // --- –ú–ê–ì–ê–ó–ò–ù ---
        const shop = {
            tab: 'color',
            open() {
                document.getElementById('menu').style.display = 'none';
                document.getElementById('shop').style.display = 'flex';
                this.render();
            },
            close() {
                document.getElementById('shop').style.display = 'none';
                document.getElementById('menu').style.display = 'flex';
            },
            setTab(t) {
                this.tab = t;
                document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
                event.target.classList.add('active');
                this.render();
            },
            render() {
                const grid = document.getElementById('shop-grid');
                grid.innerHTML = '';
                db[this.tab].forEach(item => {
                    const isOwned = storage.owned.includes(item.id);
                    const isActive = storage.active[this.tab] === item.val;
                    const div = document.createElement('div');
                    div.className = `item ${isOwned ? 'owned' : ''} ${isActive ? 'active' : ''}`;
                    div.innerHTML = `
                        <div style="font-size:10px">${item.name}</div>
                        <div class="item-icon" style="background:${this.tab==='color'?item.val:'#444'}"></div>
                        <div class="price">${isOwned ? (isActive?'–í–´–ë–†–ê–ù–û':'–ï–°–¢–¨') : 'üí∞'+item.p}</div>
                    `;
                    div.onclick = () => this.buy(item);
                    grid.appendChild(div);
                });
            },
            buy(item) {
                if (storage.owned.includes(item.id)) {
                    storage.active[this.tab] = item.val;
                } else if (storage.coins >= item.p) {
                    storage.coins -= item.p;
                    storage.owned.push(item.id);
                    storage.active[this.tab] = item.val;
                    this.save();
                }
                this.render();
                ui.update();
            },
            save() {
                localStorage.setItem('gd_coins', storage.coins);
                localStorage.setItem('gd_owned', JSON.stringify(storage.owned));
            }
        };

        // --- –ò–ì–†–û–í–û–ô –î–í–ò–ñ–û–ö ---
        const game = {
            active: false,
            score: 0,
            frame: 0,
            speed: 8,
            groundY: canvas.height - 120,
            objs: [],
            particles: [],
            
            start() {
                this.active = true;
                this.score = 0;
                this.frame = 0;
                this.speed = 8;
                this.objs = [];
                this.particles = [];
                player.reset();
                document.getElementById('menu').style.display = 'none';
                ui.update();
            },
            
            stop() {
                this.active = false;
                if (this.score > storage.best) {
                    storage.best = this.score;
                    localStorage.setItem('gd_best', storage.best);
                }
                document.getElementById('m-title').innerText = "GAME OVER";
                document.getElementById('menu').style.display = 'flex';
                ui.update();
            },

            spawn() {
                if (this.frame % 100 === 0) this.objs.push({ x: canvas.width, type: 'spike' });
                if (this.frame % 180 === 0) this.objs.push({ x: canvas.width, y: this.groundY - 80 - Math.random()*80, type: 'coin' });
            },

            update() {
                if (!this.active) return;
                this.frame++;
                player.update();
                this.spawn();

                for (let i = this.objs.length - 1; i >= 0; i--) {
                    let o = this.objs[i];
                    o.x -= this.speed;

                    // –ö–æ–ª–ª–∏–∑–∏–∏
                    if (o.type === 'spike') {
                        if (player.x + 32 > o.x + 10 && player.x + 8 < o.x + 30 && player.y + 35 > this.groundY - 35) {
                            this.explode(player.x, player.y, storage.active.color);
                            this.stop();
                        }
                    } else if (o.type === 'coin') {
                        if (Math.hypot(player.x+20 - o.x, player.y+20 - o.y) < 35) {
                            storage.coins++;
                            this.objs.splice(i, 1);
                            shop.save();
                            ui.update();
                            continue;
                        }
                    }

                    if (o.x < -100) {
                        if (o.type === 'spike') { this.score++; ui.update(); }
                        this.objs.splice(i, 1);
                    }
                }

                this.particles.forEach((p, i) => {
                    p.x += p.vx; p.y += p.vy; p.a -= 0.02;
                    if (p.a <= 0) this.particles.splice(i, 1);
                });

                this.speed += 0.001;
            },

            explode(x, y, color) {
                for(let i=0; i<15; i++) {
                    this.particles.push({
                        x: x+20, y: y+20, 
                        vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, 
                        a: 1, c: color
                    });
                }
            },

            draw() {
                // –§–æ–Ω
                ctx.fillStyle = storage.active.world;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –ü–æ–ª
                ctx.fillStyle = '#000';
                ctx.fillRect(0, this.groundY, canvas.width, canvas.height);
                ctx.strokeStyle = '#3498db'; ctx.lineWidth = 4;
                ctx.strokeRect(-5, this.groundY, canvas.width+10, 5);

                this.objs.forEach(o => {
                    if (o.type === 'spike') {
                        ctx.fillStyle = '#333'; ctx.beginPath();
                        ctx.moveTo(o.x, this.groundY); ctx.lineTo(o.x+20, this.groundY-40); ctx.lineTo(o.x+40, this.groundY);
                        ctx.fill(); ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.stroke();
                    } else {
                        ctx.fillStyle = '#f1c40f'; ctx.beginPath();
                        ctx.arc(o.x, o.y, 12, 0, Math.PI*2); ctx.fill();
                        ctx.strokeStyle="#fff"; ctx.stroke();
                    }
                });

                this.particles.forEach(p => {
                    ctx.globalAlpha = p.a; ctx.fillStyle = p.c;
                    ctx.fillRect(p.x, p.y, 6, 6);
                });
                ctx.globalAlpha = 1;

                player.draw();
            }
        };

        const player = {
            x: 80, y: 0, vy: 0, rot: 0, trail: [],
            reset() { this.y = game.groundY - 40; this.vy = 0; this.rot = 0; this.trail = []; },
            update() {
                this.vy += 0.85; this.y += this.vy;
                if (this.y > game.groundY - 40) {
                    this.y = game.groundY - 40; this.vy = 0; this.rot = 0;
                } else { this.rot += 6; }

                if (game.frame % 2 === 0) this.trail.push({x: this.x, y: this.y, a: 0.6});
                this.trail.forEach((t, i) => {
                    t.x -= game.speed; t.a -= 0.05;
                    if (t.a <= 0) this.trail.splice(i, 1);
                });
            },
            draw() {
                this.trail.forEach(t => {
                    ctx.fillStyle = `rgba(255,255,255,${t.a})`;
                    ctx.fillRect(t.x+5, t.y+5, 30, 30);
                });

                ctx.save();
                ctx.translate(this.x+20, this.y+20);
                ctx.rotate(this.rot * Math.PI/180);
                ctx.fillStyle = storage.active.color;
                ctx.fillRect(-20, -20, 40, 40);
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.strokeRect(-20, -20, 40, 40);
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ—Ä–º—ã
                ctx.fillStyle = '#000';
                if (storage.active.shape === 'eye') {
                    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI*2); ctx.fill();
                    ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(0,0,4,0,Math.PI*2); ctx.fill();
                } else if (storage.active.shape === 'smile') {
                    ctx.fillRect(-10,-10,5,5); ctx.fillRect(5,-10,5,5);
                    ctx.beginPath(); ctx.arc(0,5,8,0,Math.PI); ctx.stroke();
                } else if (storage.active.shape === 'alien') {
                    ctx.fillRect(-12,-5,24,10); ctx.fillStyle='#fff'; ctx.fillRect(-8,-2,4,4); ctx.fillRect(4,-2,4,4);
                }
                ctx.restore();
            }
        };

        const ui = {
            update() {
                document.getElementById('cur-score').innerText = game.score;
                document.getElementById('coins').innerText = storage.coins;
                document.getElementById('best-score').innerText = storage.best;
            }
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
        const handleAction = (e) => {
            if (e) e.preventDefault();
            if (game.active && player.y >= game.groundY - 42) player.vy = -14;
        };

        window.addEventListener('touchstart', handleAction, {passive: false});
        window.addEventListener('mousedown', handleAction);

        function mainLoop() {
            game.update();
            game.draw();
            requestAnimationFrame(mainLoop);
        }

        ui.update();
        mainLoop();
    </script>
</body>
</html>
