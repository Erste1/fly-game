<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Neon Dash Ultimate</title>

<style>
:root{
 --accent:#00ffb3;
 --glass:rgba(255,255,255,.07);
}

body{
 margin:0;
 overflow:hidden;
 background:#000;
 font-family:system-ui;
 color:#fff;
}

/* canvas */
canvas{display:block}

/* HUD */
#hud{
 position:fixed;
 top:12px;
 left:0;
 width:100%;
 display:flex;
 justify-content:space-between;
 padding:0 16px;
 font-weight:700;
 z-index:5;
}

#progress{
 position:fixed;
 bottom:0;
 left:0;
 height:5px;
 background:var(--accent);
 width:0%;
}

/* ===== MODAL ===== */
.modal{
 position:fixed;
 inset:0;
 display:flex;
 justify-content:center;
 align-items:center;
 backdrop-filter:blur(18px);
 background:rgba(0,0,0,.7);
 z-index:20;
}

.card{
 width:92%;
 max-width:420px;
 background:var(--glass);
 border-radius:22px;
 padding:22px;
 border:1px solid rgba(255,255,255,.1);
}

.btn{
 width:100%;
 padding:14px;
 margin:6px 0;
 border:none;
 border-radius:14px;
 font-weight:800;
 background:var(--accent);
 color:#000;
}

/* SHOP */
.tabs{display:flex;gap:6px;margin-bottom:8px}
.tab{flex:1;padding:8px;background:#222;border-radius:10px;text-align:center}
.tab.active{background:var(--accent);color:#000}

.grid{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:8px;
 max-height:260px;
 overflow:auto;
}

.item{
 height:60px;
 border-radius:12px;
 background:#222;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:22px;
}
.item.active{outline:3px solid #fff}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="hud">
 <div>SCORE <span id="score">0</span></div>
 <div>ðŸ’° <span id="coins">0</span></div>
</div>

<div id="progress"></div>

<!-- MENU -->
<div id="menu" class="modal">
 <div class="card">
  <h2>NEON DASH</h2>
  <button class="btn" id="playBtn">PLAY</button>
  <button class="btn" id="shopBtn">SHOP</button>
 </div>
</div>

<!-- SHOP -->
<div id="shop" class="modal" style="display:none">
 <div class="card">
  <div class="tabs">
   <div class="tab active" data-tab="color">Color</div>
   <div class="tab" data-tab="shape">Shape</div>
   <div class="tab" data-tab="bg">Background</div>
  </div>
  <div id="items" class="grid"></div>
  <button class="btn" id="closeShop">BACK</button>
 </div>
</div>

<script>
const canvas=c;
const ctx=canvas.getContext("2d");

function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

/* SAVE */
const S={l:(k,d)=>JSON.parse(localStorage.getItem(k))??d,s:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};

let coinsVal=S.l("coins",0);

let state={
 color:S.l("color","#00ffb3"),
 shape:S.l("shape","square"),
 bg:S.l("bg","#00151d")
};

/* SHOP DB */
const DB={
 color:["#00ffb3","#e74c3c","#3498db","#f1c40f","#9b59b6","#ffffff"],
 shape:["square","circle","diamond","triangle"],
 bg:["#00151d","#2b0000","#001b0d","#1a0030"]
};

/* SHOP */
let tab="color";

function renderShop(){
 items.innerHTML="";
 DB[tab].forEach(v=>{
  const d=document.createElement("div");
  d.className="item"+(state[tab]===v?" active":"");
  if(tab==="color"||tab==="bg") d.style.background=v;
  else d.textContent=v[0].toUpperCase();

  d.onpointerdown=()=>{
   state[tab]=v;
   S.s(tab,v);
   renderShop();
  };
  items.appendChild(d);
 });
}
renderShop();

/* TABS */
document.querySelectorAll(".tab").forEach(t=>{
 t.onpointerdown=()=>{
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  t.classList.add("active");
  tab=t.dataset.tab;
  renderShop();
 };
});

/* PLAYER */
const Player={
 x:100,y:0,vy:0,rot:0,jumps:0,

 reset(){
  this.y=Game.ground-40;
  this.vy=0;
  this.jumps=0;
 },

 jump(){
  if(this.jumps<2){
   this.vy=-15;
   this.jumps++;
  }
 },

 update(){
  this.vy+=0.9;
  this.y+=this.vy;

  if(this.y>=Game.ground-40){
   this.y=Game.ground-40;
   this.vy=0;
   this.jumps=0;
   this.rot=0;
  }else{
   this.rot+=8;
  }
 },

 draw(){
  ctx.save();
  ctx.translate(this.x+20,this.y+20);
  ctx.rotate(this.rot*Math.PI/180);
  ctx.fillStyle=state.color;
  ctx.shadowColor=state.color;
  ctx.shadowBlur=20;

  if(state.shape==="circle"){
   ctx.beginPath(); ctx.arc(0,0,20,0,Math.PI*2); ctx.fill();
  }
  else if(state.shape==="diamond"){
   ctx.rotate(Math.PI/4); ctx.fillRect(-18,-18,36,36);
  }
  else if(state.shape==="triangle"){
   ctx.beginPath(); ctx.moveTo(0,-20); ctx.lineTo(20,20); ctx.lineTo(-20,20); ctx.fill();
  }
  else{
   ctx.fillRect(-20,-20,40,40);
  }

  ctx.restore();
 }
};

/* GAME */
const Game={
 active:false,
 ground:0,
 objs:[],
 score:0,
 speed:6,
 frame:0,

 start(){
  menu.style.display="none";
  this.active=true;
  this.score=0;
  this.speed=6;
  this.objs=[];
  Player.reset();
 },

 over(){
  this.active=false;
  menu.style.display="flex";
 },

 update(){
  if(!this.active)return;

  this.frame++;
  Player.update();

  if(this.frame%70===0)
   this.objs.push({x:canvas.width,type:Math.random()<.5?"spike":"plat",y:0});

  for(let o of this.objs){
   o.x-=this.speed;
   if(o.type==="plat") o.y=this.ground-120;
  }

  this.objs=this.objs.filter(o=>{
   if(o.type==="spike"){
    if(Math.abs(o.x-Player.x)<30 && Player.y>this.ground-60) this.over();
   }
   else{
    if(Math.abs(o.x-Player.x)<40 && Player.y>o.y-40 && Player.y<o.y)
      Player.y=o.y-40;
   }

   if(o.x<-60){
    this.score++;
    return false;
   }
   return true;
  });
 },

 draw(){
  ctx.fillStyle=state.bg;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  this.ground=canvas.height-100;

  ctx.fillStyle="#111";
  ctx.fillRect(0,this.ground,canvas.width,200);

  ctx.shadowBlur=20;

  this.objs.forEach(o=>{
   if(o.type==="spike"){
    ctx.fillStyle="#ff0055";
    ctx.beginPath();
    ctx.moveTo(o.x,this.ground);
    ctx.lineTo(o.x+20,this.ground-40);
    ctx.lineTo(o.x+40,this.ground);
    ctx.fill();
   }else{
    ctx.fillStyle="#00ffb3";
    ctx.fillRect(o.x,o.y,80,10);
   }
  });

  ctx.shadowBlur=0;

  Player.draw();
 }
};

function loop(){
 Game.update();
 Game.draw();

 score.textContent=Game.score;
 coins.textContent=coinsVal;
 progress.style.width=(Game.score%100)+"%";

 requestAnimationFrame(loop);
}
loop();

/* INPUT */
addEventListener("pointerdown",()=>Player.jump());

playBtn.onpointerdown=()=>Game.start();
shopBtn.onpointerdown=()=>shop.style.display="flex";
closeShop.onpointerdown=()=>shop.style.display="none";
</script>
</body>
</html>
